# 모델 변환과 시점 변환

## 지엘의 시점 변환

### 시점 좌표계

그래픽에서 시점은 물체를 바라보는 위치를 말한다. 피사체를 찍는 카메라의 위차가 시점의 개념과 동일하다고 보기 때문에 일명 '카메라 위치'라고도 한다. 시점이라는 말은 보는 위치만을 의미하기 때문에, 엄밀하게는 **시점 좌표계** 라는 용어를 사용해야 한다.

전역 좌표계를 모델 좌표계와 일치시키는 변환이 바로 모델 행렬이다. 따라서 모델 행렬에 모델 좌표를 곱하면 물체 좌표는 전역 좌표로 바뀐다. 이 다음 과정이 전역 좌표계 기준의 좌표를 관찰자의 시점을 기준으로 설정된 시점 좌표계 기준의 좌표로 변환하는 일이다. 이 변환이 필요한 이유는 동일한 장면이라도 시점의 위치나 바라보는 방향에 따라 서로 다른 모습이 보이기 때문이다. 시점 좌표계를 전역 좌표계와 일지시키는 변환은 뷰 행렬이고 일반적으로 지엘에서는 모델 행렬과 뷰 행렬을 합하여 하나의 행렬-모델 뷰 행렬로 취급한다.

### 시점 좌표계 설정

시점 좌표계 설정하는 것은 매우 단순하다.  
카메라 위치가 시점 좌표계의 원점이라는 것을 계속 생각해야한다.
카메라는 전역 좌표계 원점을 바라보고 있으며, 이 방향은 시점 좌표계의 z축으로 잡는다. z축에서 수직으로 서 있는 면을 **투상면** 이라 하며 투상면에는 나중에 물체의 영상이 맺힌다. 투상면 자체는 무한 크기이므로 **뷰 윈도우** 라는 사각형을 정의하고 그 내부에 맺힌 영상만을 화면에 출력할 수 있다. 뷰 윈도우는 카메라 필름에 해당한다고 할 수 있다.

시점 좌표계의 y축은 뷰 윈도우의 y축과 나란히 잡는다. 뷰 윈도우가 투상면 위에 있고, 투상면이 z축에 수직이므로, 결과적으로 y축은 z축에 수직이다. 이렇게 함으로써 카메라 원점을 중심으로 y, z축 방향이 확정된다. 최종적으로 y-z평면에 수직인 방향으로 x축을 잡으면 x축 방향이 확정된다.

| 용어 | 설명 |
| :------------- | :------------- |
| 롤링(렌더맨) | z축을 중심으로 카메라가 회전 |
| 롤(비행시뮬레이션) | 비행기 진행 방향인 z축을 기준으로 x축이 회전하는 각, 무게 중심이 좌우로 이동하기 위한 것|
| 피치(비행시뮬레이션)| x축을 기준으로 z축이 회전하는 각, 고도를 위아래로 조절하기 위한 것|
| 요(비행시뮬레이션) | y축을 기준으로 z축이 회전하는 각, 진행방향을 좌우로 조절하기 위한 것 |

카메라의 시점 방향은 오른손 좌표계를 기준으로 -z 방향을 바라본다.

### 지엘의 시점 좌표계

지엘의 시점좌표계는 다음 3가지 요소에 의해 정의된다.

- 카메라 위치
- 카메라가 바라보는 점, 즉 초점의 위치
- 카메라 기울임

카메라 기울임을 고려해야 하는 이유는 동일한 대상이더라도 카메라를 눕혀서 찍을 수도 있지만 세워서 찍을 수도 있기 때문이다. 지엘의 시점 좌표계 설정은 다음과 같은 glu함수를 사용한다.

```
void gluLookAt(GLdouble eyex, GLdouble eyey, GLdouble eyez, GLdouble atx, GLdouble aty, GLdouble atz, GLdouble upx, GLdouble upy, GLdouble upz);
```

시점 좌표계를 정의하는 이 함수는 (eyex, eyey, eyez)에 있는 카메라가 (atx, aty, atz)에 있는 초점을 바라보게 하라는 것이다. (upx, upy, upz)는 카메라 상향 벡터, 즉 기울임이다.

gluLookAt()함수의 파라미터는 전역 좌로 표시해야 한다. 하나의 장면에 여러 물체가 있다면 각 물체의 모델 좌표계는 서로 다르다. 따라서 시점의 위치를 어느 물체의 모델 좌표계를 기준으로 할 수 없다. 모델 변환이 끝나고 시점 좌표계를 정의하는 단계에서 기준 좌표계는 전역 좌표계이기 때문이다.

기본값으로 지엘의 시점 좌표계는 전역 좌표계와 일치하며, 카메라 방향은 오른손 좌표계를 기준으로 0z 방향으로 바라보되 기울어지지 않고 정면을 주시한다. 따라서 카메라 위를 향하는 **상향 벡터** 는 (0, 1, 0)로 표시된다. 이 경우, 사실상 시점 좌표계는 전역 좌표계와 일치하는 것으로 다음 함수를 호출한 것과 동일한 효과를 지닌다.

```
gluLookAt(0.0, 0.0, 0.0,-------------------카메라의 위치
          0.0, 0.0, -1.0,------------------카메라 초점 방향
          0.0, 1.0, 0.0);------------------카메라 상향 벡터(기울임)
```

뷰 행렬과 모델 행렬과의 관계를 살펴보면 뷰 행렬은 gluLookAt()에 의해 정의된 시점 좌표계를 전역 좌표계로 일치시키는 행렬이다. 한편, 모델 행렬은 전역 좌표계를 모델 좌표계와 일치시키는 행렬이다. 따라서 뷰 행렬 V, 모델 행렬 M이라 하면, 다음과 같은 관계가 성립한다.

P<sub>WCS</sub> = MㆍP<sub>MCS</sub>  
P<sub>VCS</sub> = VㆍP<sub>WCS</sub> = VㆍMㆍP<sub>MCS</sub>

모델 행렬 M을 모델 좌표계 기준의 정점 P<sub>MCS</sub>에 곱하면 전역 좌표계를 기준으로 표시된다. 또 뷰 행렬 V을 전역 좌표계 기준의 정점 P<sub>WCS</sub>에 곱하면 시점 좌표계 기준으로 표시된다는 것이다.

(VㆍM)이 모델 뷰 행렬이다. 여기서 알 수 있는 것처럼 gluLookAt()에 의해 결정된 뷰 행렬은 모델 행렬의 왼쪽에 곱해져야 한다. 이같은 점을 감안한다면 gluLookAt()함수는 다음과 같이 모델 뷰 행렬을 초기화한 직후에 호출해야 한다. 지엘 함수는 좌표축 변환 순서대로 호출되고, 행렬은 이 순서대로 곱해지기 때문이다.


### 시점 설정에 의한 애니메이션

gluLookAt() 함수에 의해 시점 좌표계 원점은 (eyex, eyey, eyez)에 위치한다. 또 시점 좌표계의 z축은 원점에서 초점을 향한 시선 방향의 벡터, 즉 (atx-eyex, aty-eyey, atz-eyez)가 된다. (upx, upy, upz)에 의해 정의된 카메라 상향 벡터를 시선에 수직인 평면에 투상한 것이 y축이다. 이렇게 정의된 2개의 벡터에 수직인 벡터가 자동으로 x축이 된다.

애니메이션에는 물체를 움직이거나, 카메라를 움직이는 방법이 사용된다. 결과적으로 효과는 동일하지만 특히 물체를 중심으로 카메라를 회전시키는 것을 오비팅이라한다. 
