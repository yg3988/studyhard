# 투상 변환과 뷰 포트 변환

## 지엘의 투상 변환

### 투상 변환

모델 변환과 시점 변환을 행렬로 표시한 것이 모델 뷰 행렬이라면, 투상 변환을 행렬로 표시한 것은 **투상 행렬** 이다. 따라서 투상 방법에 따라 투상 행렬의 내용이 바뀐다.

행렬 모드를 설정하지 않을 경우의 기본값은 모델 뷰 행렬이다. 투상을 가하기 위해서는 반드시 투상 행렬을 매개변수로 넣고 호출해야한다.

`void glMatrixMode(GL_PROJECTION)`

전에 적었다시피 투상 행렬 스택은 최소 2개 이상이고 스택의 맨 위에 있는 것이 현 변환 행렬이다. 투상 행렬의 현 변환 행렬로, 모델 뷰 행렬의 현 변환 행렬과는 완전히 별개의 행렬임에 유의해야 한다.

모델 뷰 행렬에 대한 작업이나 투상 행렬에 대한 작업 모두가 기하 변환에 속하므로, 동일한 지엘 함수를 통해 이루어진다. 따라서 프로그래머는 행렬 모드 설정에 의해, 현재 어떤 행렬에 작업을 가하는지 분명히 해야한다. 함수 호출 순서는 모델 뷰 변환과 투상 변환은 어떤 것이 먼저 오더라도 무관하다. 이는 모델 뷰 변환과 투상 변환이 조작하는 대상 행렬이 서로 다르기 때문이다.

### 지엘의 평행 투상

지엘의 카메라는 기본적으로 -z 방향을 바라본다. 평행 투상에서 투상선은 z축과 나란히 진행하므로 점 P는 점P′ 위치로 투상된다.

z값이 클수록 시점에서 멀어진다는 점에서 z를 '물체의 깊이'라고도 한다. 실제로 눈에 보이는 것은 가까운 것, 즉 깊이가 작은 것이다. 그런데 만약 변환을 가하게 되면 깊이가 d로 바뀌어 원래 좌표에 포함된 깊이 정보를 잃게 된다.

한 번 가한 변환을 취소하고 원래의 값으로 되돌릴 수 없는 변환을 **특이 변환** 이라 한다. 한 번 투상되면 그것이 어디에서 왔는지, 즉 z값이 원래 얼마였는지를 회복할 수 없다는 말이다. 평행 투상에서의 이러한 변환은 실제로는 무의미하다. 원래의 좌표 (x, y, z, 1)를 그대로 둔 채 (x, y)만 읽어 내면 그것이 투상된 2차원 좌표이기 때문이다. 투상 이후의 파이프라인에서 깊이 정보를 활용하기 위해 지엘은 이러한 변환을 가하지 않는다. 즉, 투상 결과 여전히 3차원 좌표가 유지된다.

### 평행 투상의 가시부피 설정

실제 투상에서는 투상 범위를 항상 제한해야 한다. 제한된 크기의 뷰 윈도우에 모든 물체의 영상이 맺히게 할 수는 없기 때문이다. 투상 범위를 **가시 부피** 라 부른다. 투상선에 수직으로 놓인 평면 중, 시점에서 가까운 쪽을 **전방 절단면**, 시점에서 멀리 떨어진 면을 **후방 절단면** 이라 한다. 뷰 윈도우 모서리를 지나가는 4개의 투상선과 전후방 절단면에 의해 형성되는 육면체가 바로 형행 투상의 가시 부피다.

6개의 면으로 구성된 가시 부피 안에 있는 물체만 투상된다. 즉, 가시 부피 밖에 있는 물체는 일체 보이지 않는다. 어떤 물체가 가시 부피 안팎에 걸쳐 있으면 밖에 있는 부분은 절단 되어 버려지고, 안에 있는 부분만 투상되어 보이게 된다. 평행 투상의 가시 부피 설정을 위한 지엘 함수는 다음과 같다.

`void glOrtho(GLdouble left, GLdouble right, GLdouble bottom, GLdouble top, GLdouble near, GLdouble far);`

파라미터 left, right, bottom, top, near, far는 각각 가시 부피의 좌ㆍ우ㆍ하ㆍ상ㆍ전ㆍ후를 뜻한다. `glOrtho()`함수에서 전후방 절단면의 위치를 표시하는 near와 far 값은 반드시 양수로 나타낸다. 이는 시점으로부터의 절단면까지의 거리이기 때문이다. 그러나 시점 좌표계는 오른손 법칙을 따르기 때문에 near와 far값에 (-1)을 곱해야만 실제 z좌표가 나온다. 다시말해 실제 전방절단면의 z 좌표는 -near, 후방 절단면의 z 좌표는 -far이다.

### 정규화 가시 부피

지엘은 가시 부피를 그대로 사용하는 대신 다른 모습으로 편환하여 사용한다. 지엘의 **정규화 변환** 은 가시 부피의 모습을 바꾸는 변환이다. `glOrtho()`의 파라미터로 정의된 가시 부피를 가로, 세로, 높이가 2인 정육면체로 투상하는 변환이다. 변환 결과인 정육면체를 **정규화 가시 부피** 라고 한다. 정규화 변환 결과 시점 좌표계 원점은 정규화 가시 부피의 정중앙에 위치한다. 여기서 유의할 점은 정규화 가시 부피의 시점 좌표계다. 변환 이전 시점 좌표계가 오른손 법칙을 사용하는데 반해, 변환 이후 시점 좌표계는 왼손 법칙을 사용한다. 이 규칙에 따르면 정규화 가시 부피의 좌하단 좌표는 (-1, -1, -1), 우상단 좌표는 (1, 1, 1)이 된다. 

지엘에서 가시 부피 그대로 사용하지 않고 정규화 가시 부피를 사용하는 이유는 3가지다.
1. 평행 투상, 원근 투상 모두 동일한 모습의 정규화 가시 부피를 사용함으로써 파이프라인 처리구조가 동일해지기 때문
2. 가시 부피 밖의 물체를 절단하는데 있어서 정육면체를 기준으로 하는것이 훨씬 단순하다.
3. 시점 좌표계 원점을 기준으로 가로, 세로 길이를 1로 정규화함으로써 화면 좌표계로 변환하기 수월해지기 때문
