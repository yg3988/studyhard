# 데이터베이스 설계

## 데이터베이스 설계

사용자의 요구사항으로부터 현실세계를 반영한 데이터베이스 구조 도출해내는 과정
  - 어떠한 필드로 구성된 테이블을 어떠한 물리적 형태의 데이터베이스로 구성할 것인가를 결정

## 데이터베이스 설계 단계

1. 요구사항 분석
  - DB사용환경 분석 후 대상 및 제한 조건 도출
2. 개념적 설계
  - 분석 결과를 추상화된 표현 방식으로 기술 -> 개념적 스키마 생성
3. 논리적 설계
  - 논리적 데이터베이스 구조에 맞는 스키마 생성 -> 논리적 스키마 생성
4. 물리적 설계
  - 실제 컴퓨터에 저장되는 방식 설계

## 개념적 설계

사용자의 요구사항 분석 후, 컴퓨터에 표현방식보다는 추상적인 형태로 설계
  - 사용자가 이해하기 쉬운 형태로 표현
개념적 모델을 이용하여 개념적 스키마 생성  
대표적 개념적 모델 : 개체관계 모델(ER모델)  
개념적 스키마
  - 데이터베이스에 대한 추상적인 설계도
  - 개체관계 다이어그램(E-R Diagram)
    - 개체관계 모델의 표현수단
    - 'ER 스키마'라고도 함

## 물리적 설계

특정 DBMS가 제공하는 물리적 구조에 따라 테이블 저장 구조 설계  
테이블 저장 구조란?
  - 필드의 데이터 타입
  - 인덱스 지정 여부
  - 물리적 스키마
단순한 물리적 설계 과정
  - 논리적 설계 단계에서 생성된 테이블 구조도에 따라 SQL create table 구문으로 각각의 테이블 생성
추가 고려사항
  - 인덱스 설정 여부, 기본키/외래키 설정 여부

## 설계 과정의 고려사항

충실성
  - 필요로 하는 모든 데이터를 표현한다.
단순성
  - 단순하고 이해하기 쉬운 구조로 표현한다.
중복의 최소화
  - 데이터의 중복을 최소화 한다.
  - 저장공간의 효율적 사용, 데이터 일관성 유지
제약 조건의 표현
  - 데이터가 갖추어야 할 조건을 표현한다.

## 개체 관계 모델 : 개념적 설계
개체
  - 현실 세계에서 물리적/추상적으로 존재하는 실체
개체집합
  - 동일한 특성을 갖는 개체들의 모임
  - 학생 개체 집합, 학과 개체 집합
속성
  - 개체의 특성
  - 관계형 데이터 모델의 필드와 같은 개념
  - 동일한 특성을 갖는 개체 → 속성이 동일한 개체

## 필드와 속성의 차이점

필드 - 관계형 데이터 모델
  - 관계형 데이터 모델에서 테이블의 컬럼
  - 원자 값만 허용됨

속성 - 개체관계 모델
  - 개체관계 모델에서 개체의 특성
  - 다중값 속성
    - 하나의 속성에 여러 개의 값이 들어감
  - 복합 속성
    - 하나의 속성이 여러 개의 속성으로 구성됨

## 관계와 관계 집합
관계
- 개체간의 대응성을 표현
- 개체간의 관계를 통해 의미를 규정할 수 있음
  - 순서쌍으로 표현

관계 집합
- 동일한 유형의 관계들의 집합

## 관계 집합의 속성
 관계 집합에도 속성의 정의가 가능
  - 개체들간의 관계의 특성을 표현

## 관계집합의 차수

관계집합에 참여하는 개체집합의 개수

이진관계
  - 두 개체 집합 사이에 정의된 관계집합
  - 학생 - 학과의 소속관계

삼진관계
  - 세 개체집합 사이에 정의된 관계집합
  - 학생-과목-교수의 강의/수강 관계

## 관계의 대응수

관계집합에서 각 개체들이 참여할 수 있는 대응의 개수  
학생 한명은 하나의 학과에만 소속될 수 있다.

대응수의 종류
- 일대일
- 일대다(or 다대일)
- 다대다

## 약성 개체집합 vs. 강성 개체집합의
강성 개체 집합
- 기본키 형성에 필요한 속성을 모두 갖은 개체 집합
약성 개체 집합
- 기본키 형성에 필요한 속성을 모두 갖지 못한 개체 집합
- 약성 개체집합의 존재는 강성 개체집합의 존재에 의해 결정

약성 개체집합은 강성 개체집합에 항상 종속된다.
- 약성 개체집합은 독립적으로 존재할 수 없으며 강성 개체집합이 존재해야 존재할 수 있다.

약성 개체집합과 강성 개체집합의 대응수 : 다대일  
전체 참여
- 약성 개체집합의 모든 개체가 다대일 관계에 참여
부분 참여
- 약성 개체집합의 일부 개체만 다대일 관계에 참여

## 부분키, 구별자

약성 개체집합에서 강성 개체집합의 특정 개체 내에서만 유리한 값을 갖는 속성 집합

course 개체 집합의 속성 : course(course_id, title, credit)  
class 개체 집합의 속성 : class(year, semester, division, classroom, enroll)

약성 개체집합인 class 개체집합의 부분키
- 특정 교과목에 대해서만 유일한 값을 갖는 강좌의 속성
- year, semester, division

## 약성 개체 집합의 기본키

약성 개체집합 자체만으로 기본키를 가질 수 없음  
약성 개체집합의 기본키 = 약성 개체집합의 부분키 + 강성 개체집합의 기본키

강좌 개체 집합의 기본키 : **course_id**, year, semester, division

## 일반화 관계 vs. 세분화 관계

현실세계에 존재하는 개체들은 위상적으로 계층관계를 이루는 경우가 많음
  - 일반적 개념의 개체를 보다 구체화된 개념의 개체들로 분류 또는 분할해서 보여 줄 수 있음

일반화 관계 : 여러 개체집합의 공통적인 특징을 모아 상위 개체집합 생성

세분화 관계 : 하나의 개체집합을 여러 개의 하위 개체집합으로 분

## 개체관계 다이어그램

![ERDelemental](../.src/erdimage.jpg)

## ERD의 예

student와 department의 ERD

![student-dept](../.src/erdef1.jpg)

course와 class의 ERD(약성 개체 집합의 표현)
![course-class, weak](../.src/erdef2.jpg)

## 삼진관계 ERD

student, course, professor 개체집합의 개체관계

![student-course-professor](../.src/erdef3.jpg)

이진관계로 표현된 ERD

![birelation(student-course-professor)](../.src/erdef4.jpg)

## 자기연관관계 ERD

직원 개체집합
- 각 직원은 자신을 관리하는 상관이 존재
- 상관도 직원 개체집합에 속함
- 각 상관은 여러 명의 직원을 관리

![self-relation](../.src/erdselfref.jpg)

역할
- 각 객체의 역할에 따라 대응수가 다름

교과목 개체집합
- 한 교과목은 여러 개의 선수 교과목을 가짐
- 한 교과목은 여러 개의 후수 교과목을 가짐
- 다대다 자기연관관계

![self-relation2](../.src/erdselfref2.jpg)

## 개념적 설계 순서

방법 1
  - 개체집합들을 모두 결정하고 그들의 관계를 그 다음으로 결정하는 순으로 설계
방법 2
  - 요구사항에서 가장 중요하다고 판단된느 개체집합과 관계집합을 우선 결정
  - 점점 확대하여 추가적인 개체집합과 관계집합을 이끌어내는 순으로 설계
전적으로 설계자의 판단에 의해 결정
